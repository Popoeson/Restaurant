<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TastyBite | Cart</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Poppins", sans-serif; }
    body { background: #fff; color: #333; }

    header {
      display:flex; justify-content:space-between; align-items:center;
      padding: 14px 6%;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      position: sticky; top: 0; z-index: 40;
    }
    .logo { font-size: 1.4rem; font-weight:700; color:#ff6600; }
    nav { display:flex; gap:14px; align-items:center; }
    nav a, nav button { color:#333; text-decoration:none; background:none; border:none; cursor:pointer; font-weight:500; }
    nav a:hover, nav button:hover { color:#ff6600; }

    .page { display: grid; grid-template-columns: 1fr 360px; gap: 28px; padding: 30px 6%; align-items: start; }

    .packs { display:flex; flex-direction:column; gap: 16px; }
    .pack-card {
      background: #fff; border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.03);
      overflow: hidden;
    }
    .pack-header { display:flex; justify-content:space-between; align-items:center; padding: 14px 16px; background:#fff7f2; }
    .pack-header h3 { color:#333; font-weight:700; }
    .pack-header button { border:none; background:none; color:#ff6600; cursor:pointer; font-weight:600; }

    .pack-body { padding: 14px 16px; }
    .cart-item {
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;
    }
    
    .pack-card.active-pack {
  transform: scale(1.05);
  border: 2px solid #ff6600;
  box-shadow: 0 4px 16px rgba(255,102,0,0.3);
  transition: transform 0.2s, box-shadow 0.2s;
}

    .cart-item img { width:80px; height:70px; border-radius:8px; object-fit:cover; }
    .item-info { display:flex; gap:10px; align-items:center; flex:1; }
    .item-info h4 { margin-bottom:4px; }
    .item-actions button { width:28px; height:28px; border:none; border-radius:6px; background:linear-gradient(90deg,#ff8800,#ff5500); color:#fff; cursor:pointer; }
    .item-actions span { min-width:25px; text-align:center; font-weight:600; }

    .pack-subtotal { text-align:right; margin-top:10px; font-weight:700; color:#ff6600; }

    .add-more-btn {
      margin-top:10px; width:100%; padding:10px; border-radius:8px; border:none;
      background:linear-gradient(90deg,#ff8800,#ff5500);
      color:#fff; font-weight:600; cursor:pointer;
    }

    .summary {
      background:#fff; border-radius:12px; padding:16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border:1px solid rgba(0,0,0,0.03);
    }
    .summary h3 { margin-bottom:10px; color:#333; }
    .summary-row { display:flex; justify-content:space-between; margin:8px 0; color:#333; }
    .summary-row .label { color:#666; }
    .checkout {
      margin-top:12px; width:100%; padding:12px; border-radius:10px; border:none; font-weight:700;
      background: linear-gradient(90deg,#ff8800,#ff5500); color:#fff; font-size:16px; cursor:pointer;
    }

    .add-pack {
      display:block; width:100%; padding:12px; border-radius:10px; border:2px dashed #ff6600;
      background:#fff; color:#ff6600; font-weight:700; cursor:pointer; text-align:center;
    }

    .suggestions { margin-top:20px; }
    .suggestions h4 { color:#ff6600; margin-bottom:6px; }
    .suggest-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:10px; }
    .s-card {
      background:#fff; border-radius:10px; padding:8px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.04);
    }
    .s-card img { width:100%; height:90px; object-fit:cover; border-radius:8px; margin-bottom:8px; }
    .s-card button {
      padding:6px 10px; border-radius:8px; border:none; background:linear-gradient(90deg,#ff8800,#ff5500);
      color:#fff; font-weight:600; cursor:pointer;
    }

    @media(max-width:900px){ .page{grid-template-columns:1fr; padding:20px 5%;} }
  </style>
</head>
<body>
  <header>
    <div class="logo">TastyBite</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="menu.html">Menu</a>
      <a href="cart.html">ðŸ›’ Cart</a>
      <button onclick="location.href='login.html'">Login</button>
      <button onclick="location.href='register.html'">Register</button>
    </nav>
  </header>

  <main class="page">
    <section class="packs" id="packsContainer"></section>

    <aside class="right-col">
      <div class="summary">
        <h3>Order Summary</h3>
        <div class="summary-row"><div class="label">Subtotal</div><div id="subtotal">â‚¦0</div></div>
        <div class="summary-row"><div class="label">Delivery Fee</div><div id="deliveryFee">â‚¦500</div></div>
        <hr style="border:none;border-top:1px solid #eee;margin:8px 0;">
        <div class="summary-row" style="font-size:1.15rem;font-weight:700;"><div>Total</div><div id="grandTotal">â‚¦0</div></div>
        <button class="checkout" id="proceedCheckout">Proceed to Checkout</button>
      </div>

      <button class="add-pack" id="addPackBtn">+ Order Another Pack</button>

      <div class="suggestions">
        <h4>Add Something Extra ðŸ˜‹</h4>
        <div class="suggest-grid" id="suggestGrid"></div>
      </div>
    </aside>
  </main>

  <script>
const packsContainer = document.getElementById("packsContainer");
const subtotalElement = document.getElementById("subtotal");
const grandTotalElement = document.getElementById("grandTotal");
const addPackBtn = document.getElementById("addPackBtn");
const suggestGrid = document.getElementById("suggestGrid");
const proceedCheckout = document.getElementById("proceedCheckout");

let tastyPacks = JSON.parse(localStorage.getItem("tastyPacks")) || {};
let activePack = localStorage.getItem("activePack") || "Pack 1";
const deliveryFee = 500;

// ---- Helper ----
function saveData() {
  if (Object.keys(tastyPacks).length === 0) {
    localStorage.removeItem("tastyPacks");
    localStorage.removeItem("activePack");
  } else {
    localStorage.setItem("tastyPacks", JSON.stringify(tastyPacks));
    localStorage.setItem("activePack", activePack);
  }
}

function calcTotal() {
  let total = 0;
  Object.values(tastyPacks).forEach(pack => {
    pack.forEach(item => total += item.price * item.qty);
  });
  return total;
}

// ---- Render ----
function render() {
  packsContainer.innerHTML = "";
  let keys = Object.keys(tastyPacks);
  if (keys.length === 0) {
    packsContainer.innerHTML = `<p style="text-align:center;color:#777;">Your cart is empty. <a href='menu.html' style='color:#ff6600;'>Go to Menu</a></p>`;
    subtotalElement.textContent = "â‚¦0";
    grandTotalElement.textContent = "â‚¦0";
    saveData();
    return;
  }

  let subtotal = 0;
  keys.forEach(key => {
    let pack = tastyPacks[key];
    let packSubtotal = 0;
    let itemsHTML = pack.map((item, i) => {
      packSubtotal += item.price * item.qty;
      return `
        <div class="cart-item">
          <div class="item-info">
            <img src="${item.img}" alt="${item.name}">
            <div>
              <h4>${item.name}</h4>
              <p>â‚¦${item.price.toLocaleString()}</p>
            </div>
          </div>
          <div class="item-actions">
            <button onclick="decreaseQty('${key}', ${i})">-</button>
            <span>${item.qty}</span>
            <button onclick="increaseQty('${key}', ${i})">+</button>
          </div>
        </div>`;
    }).join("");

    subtotal += packSubtotal;

    packsContainer.innerHTML += `
      <div class="pack-card ${key === activePack ? "active-pack" : ""}" onclick="setActivePack('${key}')">
        <div class="pack-header">
          <h3>${key}</h3>
          <div>
            <button onclick="duplicatePack(event,'${key}')">Duplicate</button>
            <button onclick="removePack(event,'${key}')">Remove</button>
          </div>
        </div>
        <div class="pack-body">
          ${itemsHTML}
          <div class="pack-subtotal">Subtotal: â‚¦${packSubtotal.toLocaleString()}</div>
          <button class="add-more-btn" onclick="addMoreFood('${key}')">+ Add More Food</button>
        </div>
      </div>`;
  });

  subtotalElement.textContent = `â‚¦${subtotal.toLocaleString()}`;
  grandTotalElement.textContent = `â‚¦${(subtotal + deliveryFee).toLocaleString()}`;
  saveData();
}

// ---- Controls ----
function increaseQty(key, i) {
  tastyPacks[key][i].qty++;
  render();
}

function decreaseQty(key, i) {
  let item = tastyPacks[key][i];
  if (item.qty > 1) item.qty--;
  else tastyPacks[key].splice(i, 1);
  if (tastyPacks[key].length === 0) delete tastyPacks[key];
  render();
}

function removePack(e, key) {
  e.stopPropagation();
  delete tastyPacks[key];
  render();
}

function duplicatePack(e, key) {
  e.stopPropagation();
  const newKey = `Pack ${Object.keys(tastyPacks).length + 1}`;
  tastyPacks[newKey] = JSON.parse(JSON.stringify(tastyPacks[key]));
  render();
}

function addMoreFood(packKey) {
  activePack = packKey;
  saveData();
  window.location.href = "menu.html";
}

addPackBtn.onclick = () => {
  const newKey = `Pack ${Object.keys(tastyPacks).length + 1}`;
  tastyPacks[newKey] = [];
  activePack = newKey;
  saveData();
  window.location.href = "menu.html";
};

function setActivePack(key) {
  activePack = key;
  saveData();
  render();
}

// ---- Suggestions ----
async function fetchSuggestions() {
  try {
    const res = await fetch("https://restaurant-eqbo.onrender.com/api/menu");
    const data = await res.json();
    return data.filter(item => {
      if (Array.isArray(item.category)) return item.category.includes("Extras");
      return item.category === "Extras";
    });
  } catch (err) {
    console.error("Error fetching suggestions:", err);
    return [];
  }
}

async function renderSuggestions() {
  const suggestions = await fetchSuggestions();
  if (suggestions.length === 0) {
    suggestGrid.innerHTML = "<p style='color:#777;text-align:center;'>No extras available</p>";
    return;
  }
  suggestGrid.innerHTML = suggestions.map(item => `
    <div class="s-card">
      <img src="${item.imageUrl}" alt="${item.name}">
      <p>${item.name} - â‚¦${parseFloat(item.price).toLocaleString()}</p>
      <button onclick='addSuggestion("${item.name}", ${item.price}, "${item.imageUrl}")'>Add</button>
    </div>
  `).join("");
}

function addSuggestion(name, price, img) {
  if (!tastyPacks[activePack]) tastyPacks[activePack] = [];
  tastyPacks[activePack].push({ name, price, img, qty: 1 });
  saveData();
  alert(`${name} added to ${activePack}`);
  render();
}

// ---- Checkout ----
proceedCheckout.onclick = () => window.location.href = "checkout.html";

// ---- Init ----
renderSuggestions();
render();
</script>
</body>
</html>
